# Maintainer: Jos Dehaes <jos.dehaes@gmail.com>
# Maintainer: Matthias Kurz <m.kurz@irregular.at>

pkgname=tiny-dfr
pkgver=0.3.6
pkgrel=1
pkgdesc='Apple silicon touch bar input / display daemon'
arch=('aarch64')
url="https://crates.io/crates/tiny-dfr"
license=('MIT' 'APACHE')
makedepends=('rust')
depends=('pango' 'libinput' 'gdk-pixbuf2' 'librsvg')
source=("tiny-dfr-${pkgver}.tar.gz::https://crates.io/api/v1/crates/tiny-dfr/${pkgver}/download")
sha512sums=('359819eb353e00b616f06d85d0c6df1134907db524dfdbe5384c5d30245ecab0d62ba40f4e5bbd811808390c3fd2016d3f776555f3404e5e8f7de89a997c012c')

prepare() {
  cd tiny-dfr-$pkgver
  cargo fetch --locked --target "$CARCH-unknown-linux-gnu"
}

build() {
  cd tiny-dfr-$pkgver
  export CARGO_TARGET_DIR=target
  cargo build --frozen --release --all-features
}

package() {
  cd tiny-dfr-$pkgver
  install -Dm755 target/release/tiny-dfr "$pkgdir"/usr/bin/tiny-dfr
  install -Dm644 share/tiny-dfr/* -t "$pkgdir/usr/share/tiny-dfr"
  install -Dm644 etc/systemd/system/tiny-dfr.service "$pkgdir/usr/lib/systemd/system/tiny-dfr.service"
  install -Dm644 etc/udev/rules.d/99-touchbar-seat.rules "$pkgdir/usr/lib/udev/rules.d/99-touchbar-seat.rules"
  install -Dm644 etc/udev/rules.d/99-touchbar-tiny-dfr.rules "$pkgdir/usr/lib/udev/rules.d/99-touchbar-tiny-dfr.rules"
  install -Dm644 LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
  install -Dm644 LICENSE.material "$pkgdir"/usr/share/licenses/$pkgname/LICENSE.material
}
